
> @userdashboard/organizations@1.0.31 test /home/benlowry/SynologyDrive/workspaces/dashboard/organizations
> mocha src --recursive --no-colors --retries 3 --timeout 120000 --slow 120000



  /account/organizations/accept-invitation
    AcceptInvitation#GET
      ✓ should present the form
      ✓ should exclude invalid profiles
    AcceptInvitation#POST
      ✓ should reject owner
      ✓ should reject existing member
      ✓ should accept valid existing profile
      ✓ should accept invitation and create profile

  /account/organizations/create-invitation
    CreateInvitation#BEFORE
      ✓ should require owner
      ✓ should bind organization to req
    CreateInvitation#GET
      ✓ should present the form
      ✓ should present the organization
    CreateInvitation#POST
      ✓ should create invitation

  /account/organizations/create-organization
    CreateOrganization#GET
      ✓ should present the form
    CreateOrganization#POST
      ✓ should reject missing name
      ✓ should enforce name length
      ✓ should reject missing email
      ✓ should accept valid existing profile
      ✓ should create organization

  /account/organizations/delete-invitation
    DeleteInvitation#BEFORE
      ✓ should require owner
      ✓ should bind organization to req
    DeleteInvitation#GET
      ✓ should present the form
      ✓ should present the invitation
    DeleteInvitation#POST
      ✓ should delete invitation

  /account/organizations/delete-membership
    DeleteMembership#BEFORE
      ✓ should reject non-member non-owner
      ✓ should bind organization to req
    DeleteMembership#GET
      ✓ should present the form
      ✓ should present the membership
    DeleteMembership#POST
      ✓ should delete membership for member
      ✓ should delete membership for organization owner

  /account/organizations/delete-organization
    DeleteOrganization#BEFORE
      ✓ should require owner
      ✓ should bind organization to req
    DeleteOrganization#GET
      ✓ should present the form
      ✓ should present the organization
    DeleteOrganization#POST
      ✓ should delete organization

  /account/organizations/edit-membership-profile
    EditMembershipProfile#BEFORE
      ✓ should require own membership
      ✓ should bind membership to req
    EditMembershipProfile#GET
      ✓ should present the form
    EditMembershipProfile#POST
      ✓ should reject missing display name
      ✓ should reject missing display email
      ✓ should apply membership update

  /account/organizations/edit-organization
    EditOrganization#BEFORE
      ✓ should require owner
      ✓ should bind organization to req
    EditOrganization#GET
      ✓ should present the form
    EditOrganization#POST
      ✓ should reject missing name
      ✓ should enforce name length
      ✓ should reject missing email
      ✓ should apply organization update

  /account/organizations/index
    Index#BEFORE
      ✓ should bind memberships to req
      ✓ should bind organizations to req
    Index#GET
      ✓ should have row for each organization
      ✓ should have row for each membership

  /account/organizations/invitation
    Invitation#BEFORE
      ✓ should require owner
      ✓ should bind invitation to req
    Invitation#GET
      ✓ should have row for invitation

  /account/organizations/membership
    Membership#BEFORE
      ✓ should reject non-member
      ✓ should bind membership to req
    Membership#GET
      ✓ should have row for membership
      ✓ should show profile fields if data exists

  /account/organizations/memberships
    Memberships#BEFORE
      ✓ should bind memberships to req
    Memberships#GET
      ✓ should limit memberships to one page
      ✓ should enforce page size
      ✓ should enforce specified offset
      ✓ should show profile fields if data exists

  /account/organizations/organization-invitations
    Invitations#BEFORE
      ✓ should require owner
      ✓ should bind invitations to req
    Invitations#GET
      ✓ should limit invitations to one page
      ✓ should enforce page size
      ✓ should enforce specified offset

  /account/organizations/organization-memberships
    OrganizationMemberships#BEFORE
      ✓ should bind memberships to req
    Memberships#GET
      ✓ should limit memberships to one page
      ✓ should enforce page size
      ✓ should enforce specified offset

  /account/organizations/organization
    Organization#BEFORE
      ✓ should reject non-member
      ✓ should bind organization to req
    Organization#GET
      ✓ should have row for organization

  /account/organizations/organizations
    Organizations#BEFORE
      ✓ should bind owned organizations to req
    Organizations#GET
      ✓ should limit organizations to one page
      ✓ should enforce page size
      ✓ should enforce specified offset

  /account/organizations/revoke-membership
    RevokeMembership#BEFORE
      ✓ should require owner
      ✓ should bind organization to req
    RevokeMembership#GET
      ✓ should present the form
      ✓ should present the membership
    RevokeMembership#POST
      ✓ should delete membership

  /account/organizations/transfer-organization
    TransferOrganization#BEFORE
      ✓ should require owner
      ✓ should bind organization to req
      ✓ should bind memberships to req
    TransferOrganization#GET
      ✓ should present the form
      ✓ should present the organization
    TransferOrganization#POST
      ✓ should transfer ownership

  /administrator/organizations/index
    Index#BEFORE
      ✓ should bind memberships to req
      ✓ should bind organizations to req
    Index#GET
      ✓ should have row for each organization
      ✓ should have organization row for each membership

  /administrator/organizations/invitation
    Invitation#BEFORE
      ✓ should bind invitation to req
    Invitation#GET
      ✓ should have row for invitation

  /administrator/organizations/invitations
    Invitations#BEFORE
      ✓ should bind invitations to req
    returns
      ✓ array
      ✓ should enforce page size
      ✓ should enforce specified offset

  /administrator/organizations/membership
    Membership#BEFORE
      ✓ should bind membership to req
    Membership#GET
      ✓ should have row for membership

  /administrator/organizations/memberships
    Memberships#BEFORE
      ✓ should bind memberships to req
    returns
      ✓ array
      ✓ should enforce page size
      ✓ should enforce specified offset
      ✓ should show profile fields if data exists

  /administrator/organizations/organization-invitations
    OrganizationInvitations#BEFORE
      ✓ should bind invitations to req
    returns
      ✓ array
      ✓ should enforce page size
      ✓ should enforce specified offset

  /administrator/organizations/organization-memberships
    OrganizationMemberships#BEFORE
      ✓ should bind memberships to req
    returns
      ✓ array
      ✓ should enforce page size
      ✓ should enforce specified offset

  /administrator/organizations/organization
    Organization#BEFORE
      ✓ should bind organization to req
    Organization#GET
      ✓ should have row for organization

  /administrator/organizations/organizations
    Organizations#BEFORE
      ✓ should bind owned organizations to req
      ✓ should not bind member organizations to req
    returns
      ✓ array
      ✓ should enforce page size
      ✓ should enforce specified offset

  /api/administrator/organizations/account-invitations-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid value
        ✓ invalid querystring accountid value
    returns
      ✓ integer

  /api/administrator/organizations/account-invitations
    exceptions
      invalid-accountid
        ✓ missing querystring accountid value
        ✓ invalid querystring accountid value
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/organizations/account-memberships-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid value
        ✓ invalid querystring accountid value
    returns
      ✓ integer

  /api/administrator/organizations/account-memberships
    exceptions
      invalid-accountid
        ✓ missing querystring accountid value
        ✓ invalid querystring accountid value
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/organizations/account-organizations-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid value
        ✓ invalid querystring accountid value
    returns
      ✓ integer

  /api/administrator/organizations/account-organizations
    exceptions
      invalid-accountid
        ✓ missing querystring accountid value
        ✓ invalid querystring accountid value
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/organizations/invitation
    exceptions
      invalid-invitationid
        ✓ missing querystring invitationid value
        ✓ invalid querystring invitationid value
    returns
      ✓ object
    redacts
      ✓ secret code hash

  /api/administrator/organizations/invitations-count
    returns
      ✓ integer

  /api/administrator/organizations/invitations
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/organizations/membership
    exceptions
      invalid-membershipid
        ✓ missing querystring membershipid value
        ✓ invalid querystring membershipid value
    returns
      ✓ object

  /api/administrator/organizations/memberships-count
    returns
      ✓ integer

  /api/administrator/organizations/memberships
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/organizations/organization-invitations-count
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid value
        ✓ invalid querystring organizationid value
    returns
      ✓ integer

  /api/administrator/organizations/organization-invitations
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid value
        ✓ invalid querystring organizationid value
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/organizations/organization-memberships-count
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid value
        ✓ invalid querystring organizationid value
    returns
      ✓ integer

  /api/administrator/organizations/organization-memberships
    exceptions
      invalid-organizationid
        ✓ unspecified querystring organizationid
        ✓ invalid querystring organizationid value
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/organizations/organization
    exceptions
      invalid-organizationid
        ✓ unspecified querystring organizationid
        ✓ invalid querystring organizationid value
    returns
      ✓ array

  /api/administrator/organizations/organizations-count
    returns
      ✓ integer

  /api/administrator/organizations/organizations
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/organizations/create-invitation
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid
        ✓ invalid querystring organizationid
      invalid-secret-code
        ✓ missing posted secret-code
      invalid-secret-code-length
        ✓ posted secret-code too short
        ✓ posted secret-code too long
      invalid-account
        ✓ accessing account is not organization owner
    returns
      ✓ object

  /api/user/organizations/create-membership
    exceptions
      invalid-invitationid
        ✓ missing querystring invitationid
        ✓ invalid querystring invitationid
      invalid-invitation
        ✓ querystring invitationid has been used
        ✓ posted secret-code has been used
      invalid-secret-code
        ✓ missing posted secret-code
        ✓ invalid posted secret-code
      invalid-secret-code-length
        ✓ posted secret-code is blank
      invalid-account
        ✓ accessing account is organization owner
        ✓ accessing account is organization member
      invalid-profileid
        ✓ missing posted profileid
        ✓ invalid posted profileid
      invalid-profile
        ✓ ineligible posted profileid is missing fields
      invalid-invitation
        ✓ querystring invitationid is not open invitation
    returns
      ✓ object

  /api/user/organizations/create-organization
    exceptions
      invalid-organization-name
        ✓ missing posted name
    invalid-organization-name-length
      ✓ posted name too short
      ✓ posted name too long
    invalid-organization-email
      ✓ missing posted email
      ✓ invalid posted email
    invalid-profile
      ✓ missing posted profileid
      ✓ invalid posted profileid
      ✓ ineligible posted profileid missing fields
    returns
      ✓ object

  /api/user/organizations/delete-invitation
    exceptions
      invalid-invitationid
        ✓ missing querystring invitationid
        ✓ invalid querystring invitationid
      invalid-invitation
        ✓ querystring invitationid is used invitation
      invalid-account
        ✓ accessing account is not organization owner
    returns
      ✓ boolean

  /api/user/organizations/delete-membership
    exceptions
      invalid-membershipid
        ✓ missing querystring membershipid
        ✓ invalid querystring membershipid
      invalid-account
        ✓ accessing account is not membership or organization owner
    returns
      ✓ boolean

  /api/user/organizations/delete-organization
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid
        ✓ invalid querystring organizationid
      invalid-account
        ✓ accessing account does not own organization
    returns
      ✓ boolean

  /api/user/organizations/invitation
    exceptions
      invalid-invitationid
        ✓ missing querystring invitationid
        ✓ invalid querystring invitationid
      invalid-account
        ✓ accessing account is not organization owner
    returns
      ✓ object
    redacts
      ✓ secret code hash

  /api/user/organizations/invitations-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible querystring accountid
    returns
      ✓ integer

  /api/user/organizations/invitations
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible querystring accountid
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/organizations/membership
    exceptions
      invalid-membershipid
        ✓ missing querystring membershipid
        ✓ invalid querystring membershipid
      invalid-account
        ✓ accessing account must be organization member or owner
    returns
      ✓ object

  /api/user/organizations/memberships-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible querystring accountid
    returns
      ✓ integer

  /api/user/organizations/memberships
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible querystring accountid
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/organizations/invitation
    exceptions
      invalid-invitationid
        ✓ missing querystring invitationid
        ✓ invalid querystring invitationid
      invalid-invitation
        ✓ querystring invitationid is used
    returns
      ✓ object

  /api/user/organizations/open-invitation
    exceptions
      invalid-invitationid
        ✓ missing querystring invitationid
        ✓ invalid querystring invitationid
      invalid-invitation
        ✓ querystring invitationid is used
    returns
      ✓ object
    redacts
      ✓ secret code hash

  /api/user/organizations/organization-invitations-count
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid
        ✓ invalid querystring organizationid
      invalid-account
        ✓ accessing account is not organization owner
    returns
      ✓ integer

  /api/user/organizations/organization-invitations
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid
        ✓ invalid querystring organizationid
      invalid-account
        ✓ accessing account is not organization owner
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring offset (integer)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/organizations/organization-membership
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid
        ✓ invalid querystring organizationid
      invalid-account
        ✓ accessing account must be organization member
    returns
      ✓ object

  /api/user/organizations/organization-memberships-count
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid
        ✓ invalid querystring organizationid
      invalid-account
        ✓ accessing account must be organization member
    returns
      ✓ integer

  /api/user/organizations/organization-memberships
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid
        ✓ invalid querystring organizationid
      invalid-account
        ✓ accessing account must be organization member
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring offset (integer)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/organizations/organization
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid
        ✓ invalid querystring organizationid
      invalid-account
        ✓ accessing account must be organization member
    returns
      ✓ object

  /api/user/organizations/organizations-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible querystring accountid
    returns
      ✓ integer

  /api/user/organizations/organizations
    exceptions
      invalid-accountid
        ✓ missing querystring accountid
        ✓ invalid querystring accountid
      invalid-account
        ✓ ineligible querystring accountid
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ should reject other accountid
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/organizations/set-organization-owner
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid
        ✓ invalid querystring organizationid
      invalid-accountid
        ✓ posted accountid is missing
        ✓ posted accountid is invalid
      invalid-account
        ✓ accessing account is not organization owner
        ✓ posted accountid is organization owner
        ✓ posted accountid is not member
    returns
      ✓ object

  /api/user/organizations/update-organization
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid
        ✓ invalid querystring organizationid
      invalid-account
        ✓ accessing account is not organization owner
      invalid-organization-name
        ✓ missing posted name
      invalid-organization-name-length
        ✓ posted name is too short
        ✓ posted name is too long
      invalid-organization-email
        ✓ missing posted email
        ✓ invalid posted email
    returns
      ✓ object


  333 passing (2m)


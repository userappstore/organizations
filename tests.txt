
> @userappstore/organizations@1.0.1047 test /Users/benlowry/CloudStation/workspaces/dashboard/organizations
> NODE_ENV=testing mocha src --recursive --timeout 90000 --slow 90000



  internal-api/invitation
    Invitation#create()
      ✓ should require organizationid
      ✓ should create an invitation
    Invitation#delete
      ✓ should require an invitationid
      ✓ should require a valid invitationid
      ✓ should delete the invitation
    Invitation#load()
      ✓ should require invitationid
      ✓ should return the invitation
    Invitation#loadMany()
      ✓ should require one or more invitationids
      ✓ should load the invitations
    Invitation#accept()
      ✓ should require an organizationid
      ✓ should require an invitation code
      ✓ should require a valid invitation code
      ✓ should reject the owner
      ✓ should reject existing member
      ✓ should mark invitation as accepted

  internal-api/membership
    Membership#create()
      ✓ should require an organization
      ✓ should require an accountid
      ✓ should create membership
    Membership#delete
      ✓ should require a valid membershipid
      ✓ should delete membership

  internal-api/organization
    Organization#create()
      ✓ should require organization name
      ✓ should force organization name length
      ✓ should create an organization
    Organization#delete
      ✓ should require a valid organizationid
      ✓ should delete organization

  proxy/x-memberships-header
    Memberships#GET
      ✓ should add membership list to header

  proxy/x-organizations-header
    ProxyOrganizations#GET
      ✓ should add organizations list to header

  server/bind-memberships
    BindMemberships#GET
      ✓ should bind membership list to req

  server/bind-organizations
    BindOrganizations#GET
      ✓ should bind organizations list to req

  /account/organizations/accept-invitation
    AcceptInvitation#BEFORE
      ✓ should reject owner
      ✓ should reject existing member
      ✓ should bind organization to req
    AcceptInvitation#GET
      ✓ should present the form
      ✓ should present the organization
    AcceptInvitation#POST
      ✓ should apply after authorization

  /account/organizations/create-invitation
    CreateInvitation#BEFORE
      ✓ should require owner
      ✓ should bind organization to req
    CreateInvitation#GET
      ✓ should present the form
      ✓ should present the organization
    CreateInvitation#POST
      ✓ should apply after authorization

  /account/organizations/create-organization
    CreateOrganization#GET
      ✓ should present the form
    CreateOrganization#POST
      ✓ should reject missing name
      ✓ should reject short name
      ✓ should reject long name
      ✓ should reject invalid fields
      ✓ should enforce field length
      ✓ should create organization

  /account/organizations/delete-invitation
    DeleteInvitation#BEFORE
      ✓ should require owner
      ✓ should bind organization to req
    DeleteInvitation#GET
      ✓ should present the form
      ✓ should present the invitation
    DeleteInvitation#POST
      ✓ should delete invitation

  /account/organizations/delete-membership
    DeleteMembership#BEFORE
      ✓ should require own membership
      ✓ should bind organization to req
    DeleteMembership#GET
      ✓ should present the form
      ✓ should present the membership
    DeleteMembership#POST
      ✓ should delete membership

  /account/organizations/delete-organization
    DeleteOrganization#BEFORE
      ✓ should require owner
      ✓ should bind organization to req
    DeleteOrganization#GET
      ✓ should present the form
      ✓ should present the organization
    DeleteOrganization#POST
      ✓ should delete organization

  /account/organizations/edit-membership
    EditMembership#BEFORE
      ✓ should require own membership
      ✓ should bind membership to req
    EditMembership#GET
      ✓ should present the form
    EditMembership#POST
      ✓ should reject invalid fields
      ✓ should enforce field length
      ✓ should apply after authorization

  /account/organizations/edit-organization
    EditOrganization#BEFORE
      ✓ should require owner
      ✓ should bind organization to req
    EditOrganization#GET
      ✓ should present the form
    EditOrganization#POST
      ✓ should reject invalid fields
      ✓ should enforce field length
      ✓ should apply after authorization

  /account/organizations/index
    Index#BEFORE
      ✓ should bind memberships to req
      ✓ should bind organizations to req
    Index#GET
      ✓ should have row for each organization
      ✓ should have row for each membership

  /account/organizations/invitation
    Invitation#BEFORE
      ✓ should require owner
      ✓ should bind invitation to req
    Invitation#GET
      ✓ should have row for invitation

  /account/organizations/membership
    Membership#BEFORE
      ✓ should reject non-member
      ✓ should bind membership to req
    Membership#GET
      ✓ should have row for membership

  /account/organizations/memberships
    Memberships#BEFORE
      ✓ should bind memberships to req
    Memberships#GET
      ✓ should have row for each membership
      ✓ should limit memberships to one page
      ✓ should enforce page size
      ✓ should enforce specified offset

  /account/organizations/organization-invitations
    Invitations#BEFORE
      ✓ should require owner
      ✓ should bind invitations to req
    Invitations#GET
      ✓ should have row for each invitation
      ✓ should limit invitations to one page
      ✓ should enforce page size
      ✓ should enforce specified offset

  /account/organizations/organization-memberships
    Memberships#BEFORE
      ✓ should bind memberships to req
    Memberships#GET
      ✓ should have row for each membership
      ✓ should limit memberships to one page
      ✓ should enforce page size
      ✓ should enforce specified offset

  /account/organizations/organization
    Organization#BEFORE
      ✓ should reject non-member
      ✓ should bind organization to req
    Organization#GET
      ✓ should have row for organization

  /account/organizations/organizations
    Organizations#BEFORE
      ✓ should bind owned organizations to req
    Organizations#GET
      ✓ should have row for each organization
      ✓ should limit organizations to one page
      ✓ should enforce page size
      ✓ should enforce specified offset

  /account/organizations/revoke-membership
    RevokeMembership#BEFORE
      ✓ should require owner
      ✓ should bind organization to req
    RevokeMembership#GET
      ✓ should present the form
      ✓ should present the membership
    RevokeMembership#POST
      ✓ should delete membership

  /account/organizations/transfer-organization
    TransferOrganization#BEFORE
      ✓ should require owner
      ✓ should bind organization to req
      ✓ should bind memberships to req
    TransferOrganization#GET
      ✓ should present the form
      ✓ should present the organization
    TransferOrganization#POST
      ✓ should apply after authorization

  /administrator/organizations/index
    Index#BEFORE
      ✓ should bind memberships to req
      ✓ should bind organizations to req
    Index#GET
      ✓ should have row for each organization
      ✓ should have organization row for each membership

  /administrator/organizations/invitation
    Invitation#BEFORE
      ✓ should bind invitation to req
    Invitation#GET
      ✓ should have row for invitation

  /administrator/organizations/invitations
    Invitations#BEFORE
      ✓ should bind invitations to req
    Invitations#GET
      ✓ should have row for invitation
      ✓ should limit invitations to one page
      ✓ should enforce page size
      ✓ should enforce specified offset

  /administrator/organizations/membership
    Membership#BEFORE
      ✓ should bind membership to req
    Membership#GET
      ✓ should have row for membership

  /administrator/organizations/memberships
    Memberships#BEFORE
      ✓ should bind memberships to req
    Memberships#GET
      ✓ should have row for each membership
      ✓ should limit memberships to one page
      ✓ should enforce page size
      ✓ should enforce specified offset

  /administrator/organizations/organization-invitations
    OrganizationInvitations#BEFORE
      ✓ should bind invitations to req
    OrganizationInvitations#GET
      ✓ should have row for each invitation
      ✓ should limit invitations to one page
      ✓ should enforce page size
      ✓ should enforce specified offset

  /administrator/organizations/organization-memberships
    OrganizationMemberships#BEFORE
      ✓ should bind memberships to req
    OrganizationMemberships#GET
      ✓ should have row for each membership
      ✓ should limit memberships to one page
      ✓ should enforce page size
      ✓ should enforce specified offset

  /administrator/organizations/organization
    Organization#BEFORE
      ✓ should bind organization to req
    Organization#GET
      ✓ should have row for organization

  /administrator/organizations/organizations
    Organizations#BEFORE
      ✓ should bind owned organizations to req
      ✓ should not bind member organizations to req
    Organizations#GET
      ✓ should have row for each organization
      ✓ should limit organizations to one page
      ✓ should enforce page size
      ✓ should enforce specified offset

  /api/administrator/organizations/account-invitations-count
    AccountInvitationsCount#GET
      ✓ should count account's invitations

  /api/administrator/organizations/account-invitations
    Invitations#GET
      ✓ should return account's invitation list
      ✓ should enforce page size
      ✓ should enforce specified offset

  /api/administrator/organizations/account-memberships-count
    AccountMembershipsCount#GET
      ✓ should count account's memberships

  /api/administrator/organizations/account-memberships
    AccountMemberships#GET
      ✓ should return account's membership list
      ✓ should enforce page size
      ✓ should enforce specified offset

  /api/administrator/organizations/account-organizations-count
    AccountOrganizationsCount#GET
      ✓ should count account's organizations

  /api/administrator/organizations/account-organizations
    AccountOrganizations#GET
      ✓ should return account's organization list
      ✓ should enforce page size
      ✓ should enforce specified offset

  /api/administrator/organizations/invitation
    Invitation#GET
      ✓ should return invitation data
      ✓ should redact invitation code

  /api/administrator/organizations/invitations-count
    InvitationsCount#GET
      ✓ should count invitations

  /api/administrator/organizations/invitations
    Invitations#GET
      ✓ should return invitation list
      ✓ should enforce page size
      ✓ should enforce specified offset

  /api/administrator/organizations/membership
    Membership#GET
      ✓ should return membership data
      ✓ should redact membership code

  /api/administrator/organizations/memberships-count
    MembershipsCount#GET
      ✓ should count memberships

  /api/administrator/organizations/memberships
    Memberships#GET
      ✓ should return membership list
      ✓ should enforce page size (47250ms)
      ✓ should enforce specified offset (49490ms)

  /api/user/administrator/organizations/organization-invitations-count
    OrganizationInvitationsCount#GET
      ✓ should count organization's invitations

  /api/administrator/organizations/organization-invitations
    OrganizationInvitations#GET
      ✓ should return invitation list
      ✓ should enforce page size
      ✓ should enforce specified offset

  /api/administrator/organizations/organization-memberships-count
    OrganizationMembershipsCount#GET
      ✓ should count organization's memberships

  /api/administrator/organizations/organization-memberships
    OrganizationMembership#GET
      ✓ should return membership list
      ✓ should enforce page size
      ✓ should enforce specified offset

  /api/administrator/organizations/organization
    Organization#GET
      ✓ should return organization data
      ✓ should redact organization code

  /api/administrator/organizations/organizations-count
    OrganizationsCount#GET
      ✓ should count organizations

  /api/administrator/organizations/organizations
    Organizations#GET
      ✓ should return organization list
      ✓ should enforce page size
      ✓ should enforce specified offset

  /api/user/organizations/create-invitation
    CreateInvitation#POST
      ✓ should enforce code length
      ✓ should create authorized invitation

  /api/user/organizations/create-membership
    CreateMembership#POST
      ✓ should enforce code length
      ✓ should reject a used invitation
      ✓ should reject owner
      ✓ should reject existing members
      ✓ should create authorized membership

  /api/user/organizations/create-organization
    CreateOrganization#POST
      ✓ should enforce name length
      ✓ should reject invalid fields
      ✓ should create authorized organization

  /api/user/organizations/delete-invitation
    DeleteInvitation#DELETE
      ✓ should require owner
      ✓ should reject accepted invitation
      ✓ should delete invitation with authorization

  /api/user/organizations/delete-membership
    DeleteMembership#DELETE
      ✓ should reject non-owner non-member
      ✓ should delete membership

  /api/user/organizations/delete-organization
    DeleteOrganization#DELETE
      ✓ should require own organization
      ✓ should delete organization

  /api/user/organizations/invitation
    Invitation#GET
      ✓ should reject non-owner
      ✓ should return invitation
      ✓ should redact invitation code

  /api/user/organizations/invitations-count
    InvitationsCount#GET
      ✓ should count invitations

  /api/user/organizations/invitations
    Invitations#GET
      ✓ should return invitation list
      ✓ should enforce page size
      ✓ should enforce specified offset

  /api/user/organizations/membership
    Membership#GET
      ✓ should allow organization owner
      ✓ should allow organization member
      ✓ should reject non-owner non-members
      ✓ should return membership data

  /api/user/organizations/memberships-count
    MembershipsCount#GET
      ✓ should count memberships

  /api/user/organizations/memberships
    Memberships#GET
      ✓ should return membership list
      ✓ should enforce page size
      ✓ should enforce specified offset

  /api/user/organizations/open-invitation
    Invitation#GET
      ✓ should reject accepted invitation
      ✓ should return invitation and organization data
      ✓ should redact invitation code

  /api/user/organizations/organization-invitations-count
    OrganizationInvitations#GET
      ✓ should count organization's invitations

  /api/user/organizations/organization-invitations
    OrganizationInvitations#GET
      ✓ should require organization owner
      ✓ should return invitation list
      ✓ should enforce page size
      ✓ should enforce specified offset

  /api/user/organizations/organization-memberships-count
    OrganizationMembershipsCount#GET
      ✓ should count organization's memberships

  /api/user/organizations/organization-memberships
    OrganizationMemberships#GET
      ✓ should return membership list
      ✓ should enforce page size
      ✓ should enforce specified offset

  /api/user/organizations/organization
    Organization#GET
      ✓ should reject non-owner non-member
      ✓ should return organization data

  /api/user/organizations/organizations-count
    OrganizationsCount#GET
      ✓ should count organizations

  /api/user/organizations/organizations
    Organizations#GET
      ✓ should reject other accountid
      ✓ should return organization list
      ✓ should enforce page size
      ✓ should enforce specified offset

  /api/user/organizations/set-organization-owner
    SetOrganizationOwner#PATCH
      ✓ should require own organization
      ✓ should reject same owner
      ✓ should require new owner is member
      ✓ should transfer organization after authorization

  /api/user/organizations/update-membership
    UpdateMembership#PATCH
      ✓ should require own membership
      ✓ should reject invalid fields
      ✓ should enforce field length
      ✓ should apply new values

  /api/user/organizations/update-organization
    ✓ should reject invalid fields
    ✓ should enforce field length
    ✓ should apply new values


  255 passing (32m)

